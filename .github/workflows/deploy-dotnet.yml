name: Deploy .NET API

on:
  push:
    branches:
      - main  # –ê–≤—Ç–æ–¥–µ–ø–ª–æ–π –ø—Ä–∏ –ø—É—à–µ –≤ main

jobs:
  deploy:
    runs-on: ubuntu-latest

    steps:
      - name: üì• Checkout —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏—è
        uses: actions/checkout@v3

      - name: üèóÔ∏è –£—Å—Ç–∞–Ω–∞–≤–ª–∏–≤–∞–µ–º .NET SDK
        uses: actions/setup-dotnet@v3
        with:
          dotnet-version: '7.0'  # –í–µ—Ä—Å–∏—è .NET

      - name: üì¶ –°–±–æ—Ä–∫–∞ –ø—Ä–æ–µ–∫—Ç–∞
        run: |
          cd backend
          dotnet restore
          dotnet build --configuration Release

      - name: üìÇ –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∫ –∑–∞–≥—Ä—É–∑–∫–µ
        run: |
          cd backend
          zip -r api.zip ./*

      - name: üöÄ –î–µ–ø–ª–æ–π –Ω–∞ FreeASPHosting
        uses: appleboy/scp-action@master
        with:
          host: freeasphosting.net  # –ò–∑–º–µ–Ω–∏ –Ω–∞ —Å–≤–æ–π —Ö–æ—Å—Ç–∏–Ω–≥
          username: ${{ secrets.FREEASP_USERNAME }}
          password: ${{ secrets.FREEASP_PASSWORD }}
          source: "backend/api.zip"
          target: "/var/www/html/wishlist-api"
